(function(){var e=PaymentsPortal2.modules.define;e("components/SelectableGILListItemComponent","events/InstrumentRowSelectedEvent components/SelectablePaymentMethodListItemComponent components/POAInstrumentListItemComponent lang css-utils AUI!P jQuery".split(" "),function(m,d,g,h,k,l,f){var e;return d.extend({initialize:function(a,b){e=b.data.hasInelgibleLineItemsInCart;this.financialOfferCalculationStringsMap=new Map;this.financialOfferDisplayLibraryMap=b.data.financialOfferDisplayLibraryMap;this.gcAmount=
b.data.gcAmount.value;this.isCreditLine=b.data.isCreditLine;this.isMobile=b.data.isMobile;this._instrumentId=b.data.instrumentId;this.offerToAmountAllowedOnOtherPaymentMethodsMap=b.data.offerToAmountAllowedOnOtherPaymentMethodsMap;this.promoAmount=b.data.promoAmount.value;this.showGCWarning=b.data.showGCWarning;this.showGCAndPromoWarning=b.data.showGCAndPromoWarning;this.showGCAndPromoWarningforCL=b.data.showGCAndPromoWarningforCL;this.stringIdMap=b.data.stringIdMap;this.isUpdateFinancialOfferCalculationsEnabled=
b.data.isUpdateFinancialOfferCalculationsEnabled;this.showMultiTenderWarning=this.showGCWarning||this.showGCAndPromoWarning;this.currentSelectedFinancialOffer=this._getInitialSelectedFinancialOffer();this._setCurrencyUnit();this._setFinancialOfferCalculationStringsMap()},_getInitialSelectedFinancialOffer:function(){var a=window.document.getElementById("selectedFinancialOfferHiddenInput");return a?a.value:""},_setCurrencyUnit:function(){this.currencyUnit="";this.offerToAmountAllowedOnOtherPaymentMethodsMap&&
(this.currencyUnit=this.offerToAmountAllowedOnOtherPaymentMethodsMap[Object.keys(this.offerToAmountAllowedOnOtherPaymentMethodsMap)[0]].unit)},_chooseGILInstallmentOfferButtonClick:function(a){var b=f(a.currentTarget).find("input"),c=this.getDOMElement("hiddenGILFinancialOfferIdInput");this.currentSelectedFinancialOffer=b.data("financialofferid");c.val(this.currentSelectedFinancialOffer);b=this.getDOMElement("selectGILOfferAccordionButton");a=f(a.currentTarget).find(".a-section").html();b.html(a);
this.closeGilOffersAccordionPopover();this._setMultiTenderWarningMessages(this.currentSelectedFinancialOffer)},closeGilOffersAccordionPopover:function(){l.when("a-secondary-view").execute(function(a){a&&(a=a.get("gilOffersAccordionPopover"))&&a.hide()})},_hideContainer:function(a){k.hideElement(this.getDOMElement(a))},_showContainer:function(a){k.showElement(this.getDOMElement(a))},_toggleContainers:function(a,b){k.toggleElement(this.getDOMElement(a),b)},_poaInstrumentSelected:function(){h.bind(d.prototype._poaInstrumentSelected,
this).apply();this._toggleContainers("selectedFinancialOfferFormContainer",!0);this._toggleContainers("gilMultiTenderWarningsContainer",!0)},_poaInstrumentUnselected:function(){h.bind(d.prototype._poaInstrumentUnselected,this).apply();this._toggleContainers("selectedFinancialOfferFormContainer",!1);this._toggleContainers("gilMultiTenderWarningsContainer",!1)},_instrumentRowSelected:function(a){h.bind(d.prototype._instrumentRowSelected,this).apply();a===this._instrumentId?this._poaInstrumentSelected():
this._poaInstrumentUnselected()},_getWarningMessageElement:function(a){return window.document.getElementById(this._instrumentId+"-"+a)},_hasWarningMessageText:function(a){return a&&a.hasChildNodes()&&""!==a.childNodes[0].data.trim()},_formatCurrencyInDisplayLibraryMap:function(a){var b=a.currencyCode||this.currencyUnit;a.totalPaymentAmount&&!a.totalPaymentAmount.includes(b)&&(a.totalPaymentAmount=this._formatCurrency(a.totalPaymentAmount,b));a.interestAmount&&!a.interestAmount.includes(b)&&(a.interestAmount=
this._formatCurrency(a.interestAmount,b));a.averageMonthlyAmount&&!a.averageMonthlyAmount.includes(b)&&(a.averageMonthlyAmount=this._formatCurrency(a.averageMonthlyAmount,b));a.firstMonthAmount&&!a.firstMonthAmount.includes(b)&&(a.firstMonthAmount=this._formatCurrency(a.firstMonthAmount,b));return a},_getFinancialOfferCalculationStringId:function(a){a=0===parseInt(a.apr,10)?"offer_calculation_zero_interest":"offer_calculation";this.isMobile&&(a="mobile_"+a);return this.stringIdMap[a]},_setFinancialOfferCalculationStringsMap:function(){for(var a in this.financialOfferDisplayLibraryMap){var b=
new Map,c;for(c in this.financialOfferDisplayLibraryMap[a]){var d=this.financialOfferDisplayLibraryMap[a][c],d=this._formatCurrencyInDisplayLibraryMap(d);b.set(c,this._getTranslatedString(this._getFinancialOfferCalculationStringId(d),d))}this.financialOfferCalculationStringsMap.set(a,b)}},_updateFinancialOfferCalculationStringsDesktop:function(a){var b=this.financialOfferDisplayLibraryMap[a],c;for(c in b){b=this.financialOfferCalculationStringsMap.get(a).get(c);if("a-active"===f('a[data-value="'+
c+'"]').attr("class")){var d=f('a[data-value="'+c+'"]').text();f('.a-dropdown-prompt:contains("'+d+'")').text(b)}f('a[data-value="'+c+'"]').text(b);f('option[value="'+c+'"]').text(b)}},_updateElementText:function(a,b){var c=window.document.getElementById(a);c.removeChild(c.childNodes[0]);c.appendChild(window.document.createTextNode(b))},_updateFinancialOfferCalculationStringsMobile:function(a){var b=this.financialOfferDisplayLibraryMap[a],c;for(c in b){var d=this._formatCurrencyInDisplayLibraryMap(b[c]),
f=this.financialOfferCalculationStringsMap.get(a).get(c);this._updateElementText("accordionFinancialOfferCalculationText-"+c,f);this._updateElementText("accordionInstallmentText-"+c,this._getTranslatedString(this.stringIdMap.monthly_installment,d));this._updateElementText("accordionInterestText-"+c,this._getTranslatedString(this.stringIdMap.interest,d));this._updateElementText("accordionTotalPaymentText-"+c,this._getTranslatedString(this.stringIdMap.total_amount,d));c===this.currentSelectedFinancialOffer&&
this._updateElementText("selectGILOfferAccordionButtonText",f)}},_updateFinancialOfferCalculationStrings:function(a){this.isMobile?this._updateFinancialOfferCalculationStringsMobile(a):this._updateFinancialOfferCalculationStringsDesktop(a)},_gcEventHandler:function(a){var b=this._getWarningMessageElement("gilMTWarningMessageGCTextId");this.gcWarningRendered?(this._hasWarningMessageText(b)?this._showContainer("gilGCWarning"):this._hideContainer("gilGCWarning"),this.isCreditLine&&a&&this._updateFinancialOfferCalculationStrings("GiftCard")):
this._hideContainer("gilGCWarning")},_promoEventHandler:function(a){var b=this._getWarningMessageElement("gilMTWarningMessagePromoTextId");this.promoWarningRendered?(this._hasWarningMessageText(b)?this._showContainer("gilPromoWarning"):this._hideContainer("gilPromoWarning"),this.isCreditLine&&a&&this._updateFinancialOfferCalculationStrings("Promo")):this._hideContainer("gilPromoWarning")},_gcAndPromoEventHandler:function(a){var b=this._getWarningMessageElement("gilMTWarningMessageGCAndPromoContainerGCTextId"),
c=this._getWarningMessageElement("gilMTWarningMessageGCAndPromoContainerPromoTextId");this.gcAndPromoWarningRendered?(this._hasWarningMessageText(b)&&this._hasWarningMessageText(c)?this._showContainer("gilGCAndPromoWarning"):this._hideContainer("gilGCAndPromoWarning"),this.isCreditLine&&a&&this._updateFinancialOfferCalculationStrings("GiftCardAndPromo")):this._hideContainer("gilGCAndPromoWarning")},_defaultMTEventHandler:function(a){!this.isCreditLine||this.gcWarningRendered||this.promoWarningRendered||
this.gcAndPromoWarningRendered||!a||this._updateFinancialOfferCalculationStrings("Default")},_setMultiTenderWarningStates:function(a){"GC"===a.paymentMethod?a.isSelected?this.promoWarningRendered?(this.promoWarningRendered=this.gcWarningRendered=0,this.gcAndPromoWarningRendered=1):this.gcWarningRendered=1:(this.gcWarningRendered=0,this.gcAndPromoWarningRendered&&(this.gcAndPromoWarningRendered=0,this.promoWarningRendered=1)):"PROMO"===a.paymentMethod&&(a.isSelected?this.gcWarningRendered?(this.promoWarningRendered=
this.gcWarningRendered=0,this.gcAndPromoWarningRendered=1):this.promoWarningRendered=1:(this.promoWarningRendered=0,this.gcAndPromoWarningRendered&&(this.gcAndPromoWarningRendered=0,this.gcWarningRendered=1)))},_balanceSelectionEventHandler:function(a){this.showMultiTenderWarning&&(this._setMultiTenderWarningStates(a),this.showGCWarning&&this._gcEventHandler(this.isUpdateFinancialOfferCalculationsEnabled),this.showGCAndPromoWarning&&(this._promoEventHandler(this.isUpdateFinancialOfferCalculationsEnabled),
this._gcAndPromoEventHandler(this.isUpdateFinancialOfferCalculationsEnabled)),this._defaultMTEventHandler(this.isUpdateFinancialOfferCalculationsEnabled))},_formatCurrency:function(a,b){var c,d,f=b||this.currencyUnit;switch(f){case "EUR":c=",";d=".";break;default:c=".",d=","}f=f+" "+a.toString();return f=f.replace(".",c).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+d)},_getTranslatedString:function(a,b){return this.widget.getLocalizedString(a,b)},_updateWarningText:function(a,b){var c=this._getWarningMessageElement(a);
c.removeChild(c.childNodes[0]);c.appendChild(window.document.createTextNode(b))},_setGCWarningMessage:function(){var a=" ";this.amountOnOtherPaymentMethods<=this.gcAmount&&(a=this._getTranslatedString(this.stringIdMap.gift_card_info,{giftCardAmount:this._formatCurrency(this.amountOnOtherPaymentMethods)}));this._updateWarningText("gilMTWarningMessageGCTextId",a);this._gcEventHandler(!1)},_setPromoWarningMessage:function(){var a=" ";this.amountOnOtherPaymentMethods<=this.promoAmount&&(a=this._getTranslatedString(this.stringIdMap.promo_info,
{promoAmount:this._formatCurrency(this.amountOnOtherPaymentMethods)}));this._updateWarningText("gilMTWarningMessagePromoTextId",a);this._promoEventHandler(!1)},_setGCAndPromoWarningMessage:function(){var a=" ",b=" ";this.amountOnOtherPaymentMethods<=this.gcAmount+this.promoAmount&&(a=Math.round(100*(this.amountOnOtherPaymentMethods-this.promoAmount))/100,b=0<a?this._getTranslatedString(this.stringIdMap.gift_card_info,{giftCardAmount:this._formatCurrency(a<=this.gcAmount?a:this.gcAmount)}):this._getTranslatedString(this.stringIdMap.gift_card_unavailable),
a=this._getTranslatedString(this.stringIdMap.promo_info,{promoAmount:this._formatCurrency(this.amountOnOtherPaymentMethods<=this.promoAmount?this.amountOnOtherPaymentMethods:this.promoAmount)}));this._updateWarningText("gilMTWarningMessageGCAndPromoContainerPromoTextId",a);this._updateWarningText("gilMTWarningMessageGCAndPromoContainerGCTextId",b);this._gcAndPromoEventHandler(!1)},_setMultiTenderWarningMessages:function(a){a=this.offerToAmountAllowedOnOtherPaymentMethodsMap[a];!this.isCreditLine||
"undefined"!==typeof this.amountOnOtherPaymentMethods&&this.amountOnOtherPaymentMethods===a||(this.amountOnOtherPaymentMethods="undefined"===typeof a?Number.MAX_SAFE_INTEGER:a.value,this._setGCWarningMessage(),this._setPromoWarningMessage(),this._setGCAndPromoWarningMessage())},_gilOffersDropdownEventChangeHandler:function(a){this._setMultiTenderWarningMessages(a.value)},bindToEvents:function(){h.bind(d.prototype.bindToEvents,this).apply();var a=this;this.widget.on("gilCheckIneligibleItemsInCartEvent",
this,function(){e&&this.widget.trigger("gilIneligibleItemsInCartEvent",this.widget.getLocalizedString("apx_gil_cc_disabled_continue_button_hover_message"))});a.widget.on(m,a,function(b){a._instrumentRowSelected(b.instrumentId)});a.widget.on("balanceSelectionChanged",a,function(b){a._balanceSelectionEventHandler(b)});a.widget.on("gilOffersDropDownChangeEvent",a,function(b){a._gilOffersDropdownEventChangeHandler(b)});l.when("A").execute(function(b){b.declarative("chooseGILInstallemntOfferButton","click",
function(b){a._chooseGILInstallmentOfferButtonClick(b.$event)});if(a.showGCAndPromoWarningforCL)b.on("a:dropdown:selected:ppw-selectedFinancialOfferId",function(b){a.widget.trigger("gilOffersDropDownChangeEvent",b)})})}})});e("components/SelectableGILBAComponent",["form-component","jQuery","lang"],function(e,d,g){return e.extend({displayIneligibleItemsInMobile:function(e){this.widget.trigger("GILIneligibleSubPageEvent",{subtype:"StandaloneInstallment",error:function(e,g,f){d("#gil-ineligible-subpage-StandaloneInstallment-error").show()}})},
bindToElements:function(){d("#gil-ineligible-subpage-StandaloneInstallment").click(g.bind(this.displayIneligibleItemsInMobile,this))}})});e("components/SelectableGILCCComponent",["form-component","jQuery","lang"],function(e,d,g){return e.extend({displayIneligibleItemsInMobile:function(e){this.widget.trigger("GILIneligibleSubPageEvent",{subtype:"StandaloneCreditCardInstallment",error:function(e,g,f){d("#gil-ineligible-subpage-StandaloneCreditCardInstallment-error").show()}})},bindToElements:function(){d("#gil-ineligible-subpage-StandaloneCreditCardInstallment").click(g.bind(this.displayIneligibleItemsInMobile,
this))}})});e("components/SelectableGILCLComponent",["form-component","jQuery","lang"],function(e,d,g){return e.extend({displayIneligibleItemsInMobile:function(e){this.widget.trigger("GILIneligibleSubPageEvent",{subtype:"StandaloneReusableCreditLineInstallment",error:function(e,g,f){d("#gil-ineligible-subpage-StandaloneReusableCreditLine-error").show()}})},bindToElements:function(){d("#gil-ineligible-subpage-StandaloneReusableCreditLine").click(g.bind(this.displayIneligibleItemsInMobile,this))}})})})();
