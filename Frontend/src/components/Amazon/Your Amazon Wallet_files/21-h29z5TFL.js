(function(){var d=PaymentsPortal2.modules.define;d("components/DummyComponent",["component"],function(c){return c.extend({initialize:function(){window.alert("DummyComponent initialized")}})});d("components/ProductVoucherListComponent",["component"],function(c){return c.extend({initialize:function(){}})});d("components/ProductVoucherListItemComponent","events/InstrumentRowSelectedEvent public-event-registry jQuery css-utils component clog".split(" "),function(c,d,n,e,l,g){return l.extend({initialize:function(a,
b){d.register(c);this.canCoverPurchaseTotalAfterPromo=b.data.canCoverPurchaseTotalAfterPromo;this.canCoverPurchaseWithOutPromo=b.data.canCoverPurchaseTotalStandalone;this.canPromoCoverPurchaseWithoutProductVoucher=b.data.canPromoCoverPurchaseWithoutProductVoucher;this.productVoucherBalance=b.data.productVoucherBalance;this.displayablePurchaseTotal=b.data.displayablePurchaseTotal;this.displayablePurchaseTotalAfterPromo=b.data.displayablePurchaseTotalAfterPromo;this.promoIdentifier=b.data.promoIdentifier;
this.productVoucherIdentifier=b.data.productVoucherIdentifier;this.productVoucherTypeStringId=b.data.productVoucherTypeStringId;this.productVoucherType=this.widget.getLocalizedString(this.productVoucherTypeStringId);this.isRadioButtonDisplay=this.canCoverPurchaseWithOutPromo||this.canCoverPurchaseTotalAfterPromo&&!this.canPromoCoverPurchaseWithoutProductVoucher;this.productVoucherId=b.data.productVoucherId;this.$checkbox=this.getDOMElement("productVoucherBalanceSelection");this.$checkboxContainer=
this.getDOMElement("productVoucherCheckboxDisplay");this.$radioButton=this.getDOMElement("instrumentRowSelection-"+this.productVoucherId);this.$radioButtonContainer=this.getDOMElement("productVoucherRadioButtonDisplay");this.$container=this.getDOMElement("productVoucherContainer");this._setTitleAttributeToElement(this.$checkbox);this._setTitleAttributeToElement(this.$radioButton)},_setTitleAttributeToElement:function(a){try{a.length&&this.getDOMElement("productVoucherMsgWithPromo")&&this.getDOMElement("productVoucherMsgWithPromo")[0]&&
a.attr({title:this.getDOMElement("productVoucherMsgWithPromo")[0].textContent})}catch(b){g.logCounterMetric({feature:"ProductVoucherSetTitleAttributeToElement",resource:"_ErrorCount"}),g.publishMetrics()}},_checkFormInput:function(a){this.isRadioButtonDisplay?this.$radioButton.prop("checked",a):this.$checkbox.prop("checked",a)},_toggleOptionalProductVoucher:function(){if(!this.$checkbox.prop("disabled")){var a=this.$checkbox.prop("checked");this._setProductVoucher(!a)}},_setProductVoucher:function(a){a?
this._selectProductVoucher():this._unselectProductVoucher()},_unselectProductVoucher:function(){this.isRadioButtonDisplay?this.$container.toggleClass("pmts-selected",!1):this._triggerOptionalInstrumentDeselectedEvent();this._checkFormInput(!1);this._triggerBalanceSelectionChangedEvent(!1)},_selectProductVoucher:function(){this.isRadioButtonDisplay?(this.$container.toggleClass("pmts-selected",!0),this._triggerBackingInstrumentSelectedEvent(this.productVoucherId)):this._triggerOptionalInstrumentSelectedEvent();
this._checkFormInput(!0);this._triggerBalanceSelectionChangedEvent(!0)},_setDisplayToRadioButton:function(){this.isRadioButtonDisplay||(this._unselectProductVoucher(),this.isRadioButtonDisplay=!0,this._toggleRadioButtonDisplay(this.isRadioButtonDisplay))},_setDisplayToCheckBox:function(){this.isRadioButtonDisplay&&(this.$radioButton.prop("checked")&&(this._unselectProductVoucher(),this._triggerBackingInstrumentSelectedEvent(null)),this.isRadioButtonDisplay=!1,this._selectProductVoucher(),this._toggleRadioButtonDisplay(this.isRadioButtonDisplay))},
_toggleRadioButtonDisplay:function(a){e.toggleElement(this.$radioButtonContainer,a);e.toggleElement(this.$checkboxContainer,!a)},_canPVCoverPurchaseAfterPromoApplied:function(a){return a&&this.canCoverPurchaseTotalAfterPromo&&!this.canPromoCoverPurchaseWithoutProductVoucher||this.canCoverPurchaseWithOutPromo},_handlePromoSelectionChange:function(a){this._toggleProductVoucherMsg(a);this._canPVCoverPurchaseAfterPromoApplied(a)?this._setDisplayToRadioButton():this._setDisplayToCheckBox()},_toggleProductVoucherMsg:function(a){var b=
this.getDOMElement("productVoucherMsgWithoutPromo"),c=this.getDOMElement("productVoucherMsgWithPromo"),d=this.getDOMElement("productVoucherMsgWithoutPromoWithCheckbox"),m=this.getDOMElement("productVoucherMsgWithPromoWithCheckbox"),f=this._productVoucherCoverageMessage(a),f=this.widget.getLocalizedString(f.stringId,f.args),h,k;a?(h=c,k=m):(h=b,k=d);try{h[0].innerHTML=f,k[0].innerHTML=f}catch(l){g.logCounterMetric({feature:"ProductVoucherToggleProductVoucherMsg",resource:"_ErrorCount"}),g.publishMetrics()}e.toggleElement(b,
!a);e.toggleElement(c,a);e.toggleElement(d,!a);e.toggleElement(m,a)},_productVoucherCoverageMessage:function(a){var b=!this.canPromoCoverPurchaseWithoutProductVoucher&&a;return this._canPVCoverPurchaseAfterPromoApplied(a)?{stringId:"pmts_portal_payselect_use_some_of_your_available_balance_pv_type",args:{pv_balance:this.productVoucherBalance,amount_to_use:b?this.displayablePurchaseTotalAfterPromo:this.displayablePurchaseTotal,pv_type:this.productVoucherType}}:{stringId:"pmts_portal_payselect_your_available_balance_pv_type",
args:{pv_balance:this.productVoucherBalance,pv_type:this.productVoucherType}}},_triggerBalanceSelectionChangedEvent:function(a){this.widget.trigger("balanceSelectionChanged",{paymentMethod:this.productVoucherIdentifier,isSelected:a,balance:this.productVoucherBalance,isBackingInstrument:this.isRadioButtonDisplay})},_triggerInstrumentRowSelectedEvent:function(){this.widget.trigger(c,{instrumentId:this.productVoucherId,paymentMethod:this.productVoucherIdentifier})},_triggerBackingInstrumentSelectedEvent:function(a){this.widget.trigger("backingInstrumentSelected",
{instrumentId:a,paymentMethod:this.productVoucherIdentifier})},_triggerOptionalInstrumentSelectedEvent:function(){this.widget.trigger("optionalInstrumentSelected",{instrumentId:this.productVoucherId,paymentMethod:this.productVoucherIdentifier,requireBackingInstrument:this.requireBackingInstrument,balance:this.productVoucherBalance})},_triggerOptionalInstrumentDeselectedEvent:function(){this.widget.trigger("optionalInstrumentDeselected",{instrumentId:this.productVoucherId,paymentMethod:this.productVoucherIdentifier})},
_isProductVoucherSelectedAsInstrument:function(){return this.$container.hasClass("pmts-selected")},_triggerDeselectGiftCardCheckboxEvent:function(){this.widget.trigger("deselectGiftCardCheckbox",{instrumentId:this.productVoucherId,paymentMethod:this.productVoucherIdentifier})},bindToElements:function(){var a=this;a.$container.click(function(b){a.isRadioButtonDisplay?a._isProductVoucherSelectedAsInstrument()||(a._triggerDeselectGiftCardCheckboxEvent(),a._triggerInstrumentRowSelectedEvent()):(b.preventDefault(),
a._toggleOptionalProductVoucher())});a.$checkbox.click(function(b){var c=a.$checkbox.prop("checked");a._setProductVoucher(c);b.stopPropagation()})},bindToEvents:function(){var a=this;a.widget.on(c,a,function(b){a.isRadioButtonDisplay?(b.instrumentId===a.productVoucherId||a._isProductVoucherSelectedAsInstrument())&&a._setProductVoucher(b.instrumentId===a.productVoucherId):a.$checkbox.prop("disabled",b.instrumentId===a.promoIdentifier)});a.widget.on("balanceSelectionChanged",a,function(b){b.paymentMethod===
this.promoIdentifier&&a._handlePromoSelectionChange(b.isSelected)});a.widget.on("componentsInitialized",a,function(){a.isRadioButtonDisplay||(a.$checkbox.prop("checked")?(a._triggerOptionalInstrumentSelectedEvent(),a._triggerBalanceSelectionChangedEvent(!0)):a._triggerOptionalInstrumentDeselectedEvent())});a.widget.on("initializeRecommendedInstrument",a,function(b){b.instrumentId===a.productVoucherId&&a.isRadioButtonDisplay&&a._triggerInstrumentRowSelectedEvent()})}})})})();
