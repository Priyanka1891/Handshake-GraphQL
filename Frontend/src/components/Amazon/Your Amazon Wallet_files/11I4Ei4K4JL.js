(function(){var h=PaymentsPortal2.modules.define;h("components/AddCreditCardBillPaymentsComponent","form-component css-utils cc-spacing lang events/form-submitted-event jQuery form-helper mock-helper".split(" "),function(h,f,k,d,l,m,n,p){return h.extend({_countryCode:"",initialize:function(c,a){this._addButtonJSBinding=a.data.addButtonJSBinding||"newCreditCardSubmitButton";this._addFormContainerJSBinding=a.data.addFormContainerJSBinding||"addCreditCardContainer";this._accountHolderNameBinding=a.data.addAccountHolderNameBinding||
"accountHolderName";this._addCardNumberBinding=a.data.addCardNumberBinding||"addCreditCardNumber";this._placementType=a.data.placementType;this._nonCardNumberJSBinding=a.data.nonCardNumberSectionJSBinding||"nonCardNumberSection";this.form.formModel.registerAdditionalData("countryCode",d.bind(this.getCountryCode,this))},bindToElements:function(){this.getDOMElement(this._addButtonJSBinding).click(d.bind(this.handleAddCardLikeDOMEvent,this));this.getDOMElement(this._accountHolderNameBinding);var c=this.getDOMElement(this._addCardNumberBinding);
f.setElementBackgroundImage(c,this._blankIssuerImageURL,"no-repeat 96% center");var a=this,b,e;c.keydown(function(a){b=this.value;e=this.selectionStart});c.keyup(function(a){"number"!==this.type&&this.value!==b&&(a=this.selectionStart,this.value=k.fixSpacing(this.value),a=k.fixCaret(a,this.value,b,e),this.setSelectionRange(a,a))});var g=null;c.keyup(function(b){window.clearTimeout(g);g=window.setTimeout(function(){var b=c.val().replace(/\s/g,"");a.widget.trigger("creditCardNumberChanged",{creditCardNumber:b,
placementType:a._placementType})},500)})},handleAddCardLikeDOMEvent:function(c){0===this.form.validateForm().length&&(this._formSubmissionEventObj={submissionParameters:this.getFormSubmissionParameters(this._addFormContainerJSBinding),action:this._action,event:c},d.isDefined(this._formSubmissionEventObj.submissionParameters)&&d.isDefined(this._formSubmissionEventObj.submissionParameters[1])&&(this._formSubmissionEventObj.submissionParameters[1].value=this._formSubmissionEventObj.submissionParameters[1].value.replace(/\s/g,
"")),this.widget.trigger(l,this._formSubmissionEventObj));return!1},bindToEvents:function(){var c=this;this.widget.on(l,this,function(a){if(a.action===this._action){var b=m(this.getDOMElement(this._addButtonJSBinding)).closest("form");this.getDOMElement(this._addButtonJSBinding).find("input").each(function(a,c){n.ensureWidgetEventInput(b,c.name)});p.mocked(this,this._action,function(){b.submit()})}});this.widget.on("creditCardIssuerDetermined",this,function(a){a.countryCode&&(this._countryCode=a.countryCode);
var b=c.form.validateForm(!0),e=[],g=!1;d.forEach(b,function(a){a.field&&"addCreditCardNumber"===a.field&&e.push(a)});1<=e.length&&(c.form.renderErrorMessages(e),g=!0);g||(f.showElement(this.getDOMElement(this._nonCardNumberJSBinding)),a.issuerImage&&(b=this.getDOMElement(this._addCardNumberBinding),f.setElementBackgroundImage(b,a.issuerImage)))});this.widget.on("creditCardNumberReset",this,function(a){f.hideElement(this.getDOMElement(this._nonCardNumberJSBinding));a=c.form.validateForm(!0);var b=
[];d.forEach(a,function(a){a.field&&"addCreditCardNumber"===a.field&&b.push(a)});1<=b.length&&c.form.renderErrorMessages(b);a=this.getDOMElement(this._addCardNumberBinding);f.setElementBackgroundImage(a,this._blankIssuerImageURL)})},getCountryCode:function(){return this._countryCode}})})})();
